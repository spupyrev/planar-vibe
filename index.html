<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>PlanarVibe</title>
  <meta name="keywords" content="graph drawing, planar graphs, algorithms">

  <link href="static/img/favicon.jpg" type="image/ico" rel="shortcut icon" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="static/css/app.css" rel="stylesheet">
</head>


<body>
  <div class="app-shell">
    <div class="logo-block">
      <img alt="PlanarVibe" src="static/img/logo.png">
    </div>

    <div class="row g-3 main-row">
      <section class="col-12 col-lg-auto input-col">
        <div class="panel">
          <form id="graph-form" method="post" action="#" accept-charset="UTF-8" onsubmit="return checkTextArea(this)">
            <div class="wide center">
              <textarea
                name="dotfile"
                id="dotfile"
                class="wide"
                spellcheck="false"
                autofocus="autofocus"
                maxlength="10000000"
                placeholder="Paste a graph edge list..."></textarea>
              <div>
                <span class="muted">...or try an example:</span>
                <br>
                <a class="small-link" onclick="pasteStaticGraph('sample1')">[Sample1]</a>
                <a class="small-link" onclick="pasteStaticGraph('sample2')">[Sample2]</a>
                <a class="small-link" onclick="pasteStaticGraph('cycle20')">[Cycle20]</a>
                <a class="small-link" onclick="pasteStaticGraph('ladder20')">[Ladder20]</a>
                <a class="small-link" onclick="pasteStaticGraph('grid9x9')">[Grid 9x9]</a>
              </div>
            </div>

            <div style="margin:10px 0 0">
              <table class="wide center"><tbody>
                <tr>
                  <td style="width:100%; text-align:center">
                    <input id="submit" value="Create Graph" type="submit" class="btn btn-primary btn-sm"/>
                  </td>
                </tr>
              </tbody></table>
            </div>
          </form>
        </div>
      </section>

      <section class="col-12 col-lg draw-col">
        <div class="panel drawing-panel">
          <button type="button" class="btn btn-light btn-sm reset-zoom-btn" onclick="resetZoom()" title="Reset Zoom" aria-label="Reset Zoom">
            <img src="static/img/zoom-reset.svg" alt="">
          </button>
          <div id="cy"></div>
          <div class="layout-toolbar">
            <button type="button" class="btn btn-outline-secondary btn-sm layout-btn" data-layout="random" onclick="applyLayout('random')">Random</button>
            <button type="button" class="btn btn-outline-secondary btn-sm layout-btn" data-layout="circle" onclick="applyLayout('circle')">Circular</button>
            <button type="button" class="btn btn-outline-secondary btn-sm layout-btn" data-layout="cose" onclick="applyLayout('cose')">Force-Dir</button>
            <button type="button" class="btn btn-outline-secondary btn-sm layout-btn" data-layout="tutte" onclick="applyLayout('tutte')">Tutte</button>
          </div>
        </div>
      </section>
    </div>

    <div class="row g-3 status-row">
      <section class="col-12">
        <div class="panel status-panel">
          <div class="status-title">Status Bar</div>
          <div id="status"></div>
        </div>
      </section>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/cytoscape@3.29.2/dist/cytoscape.min.js"></script>
  <script src="static/js/graph-samples.js"></script>
  <script src="static/js/planarvibe-plugin.js"></script>
  <script src="static/js/tutte-layout.js"></script>
  <script>
    var LOGO_COLORS = {
      blue: '#1060A8',
      orange: '#EA9624',
      green: '#609818',
      ink: '#103870',
      black: '#111111'
    };

    var currentParsed = null;

    var cy = cytoscape({
      container: document.getElementById('cy'),
      elements: [],
      style: [
        {
          selector: 'node',
          style: {
            'background-color': LOGO_COLORS.blue,
            'border-color': LOGO_COLORS.black,
            'border-width': 0.5,
            'label': 'data(label)',
            'color': '#ffffff',
            'font-size': 11,
            'text-valign': 'center',
            'text-halign': 'center',
            'width': 28,
            'height': 28
          }
        },
        {
          selector: 'edge',
          style: {
            'line-color': LOGO_COLORS.black,
            'width': 2,
            'curve-style': 'bezier'
          }
        }
      ],
      layout: { name: 'grid' }
    });

    function setStatus(message, isError) {
      $('#status').text(message).css('color', isError ? '#ba1b1b' : LOGO_COLORS.ink);
    }

    function drawGraph() {
      try {
        currentParsed = PlanarVibePlugin.parseEdgeList($('#dotfile').val());
        cy.elements().remove();
        cy.add(currentParsed.elements);
        applyLayout('random');
        setStatus('Drawn ' + currentParsed.nodeCount + ' nodes and ' + currentParsed.edgeCount + ' edges (random coordinates)', false);
      } catch (error) {
        setStatus(error.message, true);
      }
    }

    function checkTextArea() {
      var value = $('#dotfile').val().trim();
      if (!value) {
        setStatus('Please paste a graph first', true);
        return false;
      }
      drawGraph();
      return false;
    }

    function pasteStaticGraph(name) {
      var sampleGraph = PlanarVibeSamples.getSample(name);
      if (!sampleGraph) {
        setStatus('Unknown sample: ' + name + '.', true);
        return;
      }

      $('#dotfile').val(sampleGraph);
      drawGraph();
    }

    function applyLayout(layoutName) {
      if (cy.nodes().length === 0) {
        return;
      }
      setSelectedLayoutButton(layoutName);

      if (layoutName === 'random') {
        PlanarVibePlugin.applyDeterministicRandomPositions(cy);
        setStatus('Applied random coordinates', false);
        return;
      }

      if (layoutName === 'tutte') {
        var result = PlanarVibeTutte.applyTutteLayout(cy);
        setStatus(result.message, !result.ok);
        return;
      }

      cy.layout(PlanarVibePlugin.layoutOptionsByName(layoutName, currentParsed)).run();
      setStatus('Applied ' + layoutName + ' layout', false);
    }

    function setSelectedLayoutButton(layoutName) {
      $('.layout-btn').removeClass('is-active');
      $('.layout-btn[data-layout="' + layoutName + '"]').addClass('is-active');
    }

    function resetZoom() {
      if (cy.nodes().length === 0) {
        return;
      }
      cy.fit(undefined, 20);
      cy.center();
      setStatus('Zoom reset.', false);
    }

    window.checkTextArea = checkTextArea;
    window.pasteStaticGraph = pasteStaticGraph;
    window.applyLayout = applyLayout;
    window.resetZoom = resetZoom;

    pasteStaticGraph(PlanarVibeSamples.defaultSample);
  </script>
</body>
</html>
